(documentation in progress)  

For this version, the prototype relies on CitizenWatt application.  
[CitizenWatt](http://www.citizenwatt.paris/) is an open source and open hardware sensor.  It is associated with a Python application, that runs on a Raspberry Pi 1. Data are stored locally and exposed through an API.  


The original sources are here:   
➡ Sensor : https://github.com/CitoyensCapteurs/CitizenWatt-sensor  
➡ Application : https://github.com/CitoyensCapteurs/CitizenWatt-Base  


CitizenWatt application has been modified to run on a Rapsberry Pi 3 and to work with other types of sensors:  
➡ https://github.com/DAISEE/CitizenWatt-Base-RPI3

## Application installation

For now, several branches are available:  
‣ master (works with CitizenWatt sensor, through NRF24),  
‣ smartplug (works with AWOX Smartplug, through bluetooth),  
‣ ina291 (works with [INA219 sensor](https://www.adafruit.com/product/904), directly connected to Raspberry Pi),  
‣ acs712 (works with an [ACS 712-based](http://www.allegromicro.com/en/Products/Current-Sensor-ICs/Zero-To-Fifty-Amp-Integrated-Conductor-Sensor-ICs/ACS712.aspx) sensor connected to an Arduino).  

> still under development  
> TODO : issue [DAISEE/CitizenWatt-Base-RPI3/issues/2](https://github.com/DAISEE/CitizenWatt-Base-RPI3/issues/2)
  
  
* **Python3 and packages installation**
```bash
$ git clone https://github.com/DAISEE/CitizenWatt-Base-RPI3.git
$ sudo bash system/install_req.sh 
```

* **Database creation**
```bash
$ sudo -u postgres psql
[sudo] password for debian: 
psql (9.4.9)
Type "help" for help.

postgres-# CREATE DATABASE citizenwatt;
postgres-# CREATE USER citizenwatt PASSWORD 'citizenwatt';
postgres-# GRANT ALL ON DATABASE citizenwatt TO citizenwatt;
postgres-# exit
postgres-# 
```

* **Firewall configuration**
```bash
$ sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination :8080
$ sudo netfilter-persistent save
```

* **(Additional steps) for CitizenWatt sensor**
```bash
$ sudo aptitude install libboost-python-dev 
$ sudo ln -s /usr/lib/arm-linux-gnueabihf/libboost_python-py34.so /usr/lib/arm-linux-gnueabihf/libboost_python3.so 
$ sudo aptitude install python3-setuptools 
$ ./setup.py build   
$ sudo ./setup.py install 
```

* **(Additional steps) for AWOX Smartplug**
```bash
$ sudo pip3 install bluepy
```

* **(Additional steps) for INA219 sensor**
```bash
$ sudo pip3 install pi-ina219
```

_(to be completed)_